import{r as t,c as s,h as i,H as h,g as e}from"./p-d5cea43e.js";function o(t){return t.changedTouches?t.changedTouches[0]:t}const r=class{constructor(i){t(this,i),this.drrSelect=s(this,"drrSelect",7),this.drrDidChange=s(this,"drrDidChange",7),this.unit="percentage",this.resize=!0,this.drag="all",this.rotation=!0,this.text=!1,this.minWidth=10,this.minHeight=10,this.selected=!1,this.updated=!1,this.moving=!1,this.startX=null,this.startY=null,this.startWidth=null,this.startHeight=null,this.startTop=null,this.startLeft=null,this.dragTopEnd=!1,this.dragBottomEnd=!1,this.dragBottomStart=!1,this.dragTopStart=!1,this.dragTop=!1,this.dragEnd=!1,this.dragBottom=!1,this.dragStart=!1,this.parentWidth=null,this.parentHeight=null,this.rotating=!1,this.centerX=null,this.centerY=null,this.editing=!1,this.start=async t=>{if(t&&t.target){if(!this.isTargetEvent(t))return this.stopAndReset(!1),this.selected&&this.drrSelect.emit(void 0),this.selected=!1,void this.resetTextEditable();if(!this.editing){const s=t.target.closest("deckgo-drr");this.drrSelect.emit(s),this.selected=!0,this.initTextEditable(),this.startMove()}await this.initStartPositions(t)}},this.transform=t=>{const s=this.move(t),i=this.size(t),h=this.rotateShape(t);this.updated=s||i||h},this.stop=()=>{this.stopAndReset(this.selected)},this.dbclick=async t=>{if(!this.isTargetEvent(t))return;this.editing=!0;const s=this.el.querySelector(":scope > *");s&&(s.focus(),(t=>{if(window&&document&&document.createRange&&t){let s=document.createRange();s.selectNodeContents(t),s.collapse(!1);let i=window&&window.getSelection?window.getSelection():document&&document.getSelection?document.getSelection():document&&document.selection?document.selection.createRange().text:null;i?.removeAllRanges(),i?.addRange(s)}})(s))}}async componentWillLoad(){await this.init(),await this.attachEventListeners()}async componentDidLoad(){await this.displaySlot()}async componentWillUnload(){await this.detachEventListeners()}async onPropChanges(){await this.detachEventListeners(),await this.attachEventListeners()}async attachEventListeners(){this.el&&this.el.parentElement&&!this.el.parentElement.classList.contains("deckgo-read-only")&&document&&("none"!==this.drag||this.resize)&&(document.addEventListener("mousedown",this.start.bind(this),{passive:!0}),document.addEventListener("touchstart",this.start.bind(this),{passive:!0}),document.addEventListener("mousemove",this.transform.bind(this),{passive:!0}),document.addEventListener("touchmove",this.transform.bind(this),{passive:!0}),document.addEventListener("mouseup",this.stop.bind(this),{passive:!0}),document.addEventListener("touchend",this.stop.bind(this),{passive:!0}))}async detachEventListeners(){("none"!==this.drag||this.resize)&&document&&(document.removeEventListener("mousedown",this.start,!0),document.removeEventListener("touchstart",this.start,!0),document.removeEventListener("mousemove",this.transform,!0),document.removeEventListener("touchmove",this.transform,!0),document.removeEventListener("mouseup",this.stop,!0),document.removeEventListener("touchend",this.stop,!0),document.removeEventListener("dblclick",this.dbclick,!0))}async init(){this.width=this.el.style.getPropertyValue("--width")?parseFloat(this.el.style.getPropertyValue("--width")):0,this.height=this.el.style.getPropertyValue("--height")?parseFloat(this.el.style.getPropertyValue("--height")):0,this.top=this.el.style.getPropertyValue("--top")?parseFloat(this.el.style.getPropertyValue("--top")):0,this.left=this.el.style.getPropertyValue("--left")?parseFloat(this.el.style.getPropertyValue("--left")):0,this.rotate=this.el.style.getPropertyValue("--rotate")?parseFloat(this.el.style.getPropertyValue("--rotate")):0,this.text&&(this.resize=!1)}async displaySlot(){const t=this.el.querySelector(":scope > *");t&&"none"===t.style.display&&(t.style.display="")}isTargetEvent(t){const s=t.target.closest("deckgo-drr");return s&&s.isEqualNode(this.el)}initTextEditable(){if(!this.text||!this.el)return;document.addEventListener("dblclick",this.dbclick.bind(this),{once:!0});const t=this.el.querySelector(":scope > *");t&&t.setAttribute("contentEditable","true")}resetTextEditable(){this.text&&(this.editing=!1,document&&document.removeEventListener("dblclick",this.dbclick,!0))}async initStartPositions(t){this.startX=o(t).clientX,this.startY=o(t).clientY,await this.initParentSize(),this.initStartPositionsMove(),this.initStartPositionsRotation(),this.initStartPositionsResize()}initStartPositionsMove(){this.startWidth=isNaN(this.width)?0:this.width,this.startHeight=isNaN(this.height)?0:this.height,this.startTop=this.top,this.startLeft=this.left}initStartPositionsRotation(){const t=this.el.getBoundingClientRect();this.centerX=t.left+t.width/2,this.centerY=t.top+t.height/2}initStartPositionsResize(){const t=2*Math.PI*this.rotate/360,s=Math.cos(t),i=Math.sin(t),h=window.getComputedStyle(this.el),e=parseFloat(h.left),o=parseFloat(h.top),r=parseFloat(h.width),n=parseFloat(h.height),a=this.resizeMatrix(),d=e+r/2,c=o+n/2,l=e+a.a*r,u=o+a.b*n,v=e+a.c*r,p=o+a.d*n;this.qp0_x=l*s-u*i-d*s+c*i+d,this.qp0_y=l*i+u*s-d*i-c*s+c,this.pp_x=v*s-p*i-d*s+c*i+d,this.pp_y=v*i+p*s-d*i-c*s+c}async initParentSize(){if(this.el.parentElement&&"function"==typeof this.el.parentElement.getContainer){const t=await this.el.parentElement.getContainer();this.parentWidth="percentage"===this.unit?t.offsetWidth:this.convertToUnit(t.offsetWidth,"width"),this.parentHeight="percentage"===this.unit?t.offsetHeight:this.convertToUnit(t.offsetHeight,"height")}else this.parentWidth="percentage"===this.unit?this.el.parentElement.offsetWidth:this.convertToUnit(this.el.parentElement.offsetWidth,"width"),this.parentHeight="percentage"===this.unit?this.el.parentElement.offsetHeight:this.convertToUnit(this.el.parentElement.offsetHeight,"height")}move(t){return!(!this.moving||"none"===this.drag||("x-axis"===this.drag?this.deltaMove(t,!1,!0):this.deltaMove(t,!0,"y-axis"!==this.drag),0))}size(t){return!(!this.resize||!(this.selected&&this.startX&&this.startY)||!(this.dragBottomEnd||this.dragTopEnd||this.dragBottomStart||this.dragTopStart||this.dragTop||this.dragEnd||this.dragBottom||this.dragStart)||(this.deltaResize(t),0))}deltaMove(t,s,i){const h=this.getDelta(t),e=this.convertToUnit(h.x,"width"),o=this.convertToUnit(h.y,"height");if(s){const t=this.convertParentUnit(this.parentHeight)-this.startHeight;this.top=this.startTop+o>0?this.startTop+o<t?this.startTop+o:t:0}if(i){const t=this.convertParentUnit(this.parentWidth)-this.startWidth;this.left=this.startLeft+e>0?this.startLeft+e<t?this.startLeft+e:t:0}}deltaResize(t){const s=this.getDelta(t),i=this.qp0_x+s.x,h=this.qp0_y+s.y,e=(i+this.pp_x)/2,o=(h+this.pp_y)/2,r=-1*Math.PI*2*this.rotate/360,n=Math.cos(r),a=Math.sin(r);let d=i*n-h*a-n*e+a*o+e,c=i*a+h*n-a*e-n*o+o,l=this.pp_x*n-this.pp_y*a-n*e+a*o+e,u=this.pp_x*a+this.pp_y*n-a*e-n*o+o;const v=this.resizeMatrix(),p=v.a*(d-l)+v.c*(l-d),g=v.b*(c-u)+v.d*(u-c);let m,w;if(p<this.minWidth||g<this.minHeight){m=Math.max(this.minWidth,p),w=Math.max(this.minHeight,g);const t=-1*r,s=Math.cos(t),i=Math.sin(t),h=this.pp_x+s*m*(v.a-v.c)+-i*w*(v.b-v.d),e=this.pp_y+i*m*(v.a-v.c)+s*w*(v.b-v.d),o=(h+this.pp_x)/2,b=(e+this.pp_y)/2;d=h*n-e*a-n*o+a*b+o,c=h*a+e*n-a*o-n*b+b,l=this.pp_x*n-this.pp_y*a-n*o+a*b+o,u=this.pp_x*a+this.pp_y*n-a*o-n*b+b}else m=p,w=g;const b=v.d*c+v.b*u;this.left=this.convertToUnit(v.c*d+v.a*l,"width"),this.width=this.convertToUnit(m,"width"),this.top=this.convertToUnit(b,"height"),this.height=this.convertToUnit(w,"height")}rotateShape(t){if(!this.rotating)return!1;const s=o(t).clientX,i=o(t).clientY;return this.rotate=Math.round((Math.atan2(s-this.centerX,i-this.centerY)*(180/Math.PI)*-1+180)/rotateSnap)*rotateSnap,!0}getDelta(t){const s=Math.round(o(t).clientX/gridSnap)*gridSnap,i=Math.round(o(t).clientY/gridSnap)*gridSnap;return{x:this.dragBottom||this.dragTop?0:s-this.startX,y:this.dragStart||this.dragEnd?0:i-this.startY}}convertToUnit(t,s){return"px"===this.unit?t:"viewport"===this.unit?100*t/("width"===s?window.innerWidth||screen.width:window.innerHeight||screen.height):100*t/("width"===s?this.parentWidth:this.parentHeight)}convertParentUnit(t){return"percentage"===this.unit?100:t}startMove(){this.dragBottomEnd||this.dragTopEnd||this.dragBottomStart||this.dragTopStart||this.dragTop||this.dragEnd||this.dragBottom||this.dragStart||this.rotating||(this.moving=!0)}stopAndReset(t){this.startX=null,this.startY=null,this.stopMove(),this.stopResize(),this.stopRotate(),t&&this.updated&&this.drrDidChange.emit(this.el.shadowRoot.host),this.updated=!1}stopMove(){this.moving=!1,this.startTop=null,this.startLeft=null}stopRotate(){this.rotating=!1,this.centerX=null,this.centerY=null}stopResize(){this.dragBottomEnd=!1,this.dragTopEnd=!1,this.dragBottomStart=!1,this.dragTopStart=!1,this.dragTop=!1,this.dragEnd=!1,this.dragBottom=!1,this.dragStart=!1,this.startWidth=null,this.startHeight=null}resizeMatrix(){const t=this.dragBottomEnd||this.dragTopEnd||this.dragEnd?1:0,s=this.dragBottomEnd||this.dragBottomStart||this.dragStart||this.dragBottom?1:0;return{a:t,b:s,c:1===t?0:1,d:1===s?0:1}}render(){const t="percentage"===this.unit?"%":"viewport"===this.unit?"vw":this.unit,s="percentage"===this.unit?"%":"viewport"===this.unit?"vh":this.unit;return i(h,{style:{"--width":this.text?"auto":`${this.width}${t}`,"--height":this.text?"auto":`${this.height}${s}`,"--top":`${this.top}${s}`,"--left":`${this.left}${t}`,"--rotate":this.rotate?`${this.rotate}deg`:"0deg","--pointer-events":this.editing?"all":"none","--user-select":this.text?"text":"none"},class:`${this.selected?"selected":""} ${this.text?"text":""} ${"none"!==this.drag?"draggable":""} ${"none"!==this.drag&&this.moving?"drag":""}`},this.renderEdgesAnchors(),this.renderBorderAnchors(),this.renderRotateAnchor(),i("slot",null))}renderEdgesAnchors(){if(this.selected&&this.resize)return[i("div",{class:"anchor top end",onClick:t=>t.stopPropagation(),onMouseDown:()=>this.dragTopEnd=!0,onTouchStart:()=>this.dragTopEnd=!0},i("div",null)),i("div",{class:"anchor bottom end",onClick:t=>t.stopPropagation(),onMouseDown:()=>this.dragBottomEnd=!0,onTouchStart:()=>this.dragBottomEnd=!0},i("div",null)),i("div",{class:"anchor bottom start",onClick:t=>t.stopPropagation(),onMouseDown:()=>this.dragBottomStart=!0,onTouchStart:()=>this.dragBottomStart=!0},i("div",null)),i("div",{class:"anchor top start",onClick:t=>t.stopPropagation(),onMouseDown:()=>this.dragTopStart=!0,onTouchStart:()=>this.dragTopStart=!0},i("div",null))]}renderBorderAnchors(){if(this.selected&&this.resize)return[i("div",{class:"border top",onClick:t=>t.stopPropagation(),onMouseDown:()=>this.dragTop=!0,onTouchStart:()=>this.dragTop=!0}),i("div",{class:"border end",onClick:t=>t.stopPropagation(),onMouseDown:()=>this.dragEnd=!0,onTouchStart:()=>this.dragEnd=!0}),i("div",{class:"border bottom",onClick:t=>t.stopPropagation(),onMouseDown:()=>this.dragBottom=!0,onTouchStart:()=>this.dragBottom=!0}),i("div",{class:"border start",onClick:t=>t.stopPropagation(),onMouseDown:()=>this.dragStart=!0,onTouchStart:()=>this.dragStart=!0})]}renderRotateAnchor(){if(this.selected&&this.rotation)return i("div",{class:"rotate"},i("div",{class:"action",onClick:t=>t.stopPropagation(),onMouseDown:()=>this.rotating=!0,onTouchStart:()=>this.rotating=!0},i("div",null)),i("div",{class:"presentation"}))}get el(){return e(this)}static get watchers(){return{resize:["onPropChanges"],drag:["onPropChanges"]}}};r.style=":host{display:flex;justify-content:center;align-items:center;contain:size;width:var(--width);height:var(--height);transform:rotate(var(--rotate, 0deg));position:absolute;top:var(--top);left:var(--left);-webkit-user-select:var(--deckgo-drr-user-select, none);-moz-user-select:var(--deckgo-drr-user-select, none);-ms-user-select:var(--deckgo-drr-user-select, none);user-select:var(--deckgo-drr-user-select, none)}:host(.text){contain:layout}:host(.selected.draggable:not(.drag)){cursor:move}:host(.selected){outline:var(--deckgo-drr-border, 1px solid #3880ff)}::slotted(*){width:100%;height:100%;-webkit-user-select:var(--user-select, none);-moz-user-select:var(--user-select, none);-ms-user-select:var(--user-select, none);user-select:var(--user-select, none);touch-action:none;pointer-events:var(--pointer-events, none)}div.anchor{position:absolute;width:var(--deckgo-drr-anchor-width, 16px);height:var(--deckgo-drr-anchor-height, 16px);padding:var(--deckgo-drr-anchor-padding-desktop, 16px)}div.anchor>div{width:100%;height:100%;border-radius:var(--deckgo-drr-anchor-border-radius, 50%);background:var(--deckgo-drr-anchor-background, #3880ff);border:var(--deckgo-drr-anchor-border)}div.anchor.top{top:0}div.anchor.top.end{cursor:ne-resize;transform:translate(50%, -50%)}div.anchor.top.start{cursor:nw-resize;transform:translate(-50%, -50%)}div.anchor.end{right:0}div.anchor.bottom{bottom:0}div.anchor.bottom.end{cursor:se-resize;transform:translate(50%, 50%)}div.anchor.bottom.start{cursor:sw-resize;transform:translate(-50%, 50%)}div.anchor.start{left:0}div.border{position:absolute}div.border.top,div.border.bottom{width:calc(100% - var(--deckgo-drr-anchor-width, 16px));height:16px}div.border.end,div.border.start{top:50%;height:calc(100% - var(--deckgo-drr-anchor-height, 16px));width:16px}div.border.top{top:0;left:50%;transform:translate(-50%, -50%);cursor:n-resize}div.border.end{right:0;transform:translate(50%, -50%);cursor:e-resize}div.border.bottom{bottom:0;left:50%;transform:translate(-50%, 50%);cursor:s-resize}div.border.start{left:0;transform:translate(-50%, -50%);cursor:w-resize}div.rotate{position:absolute;top:0;left:50%;transform:translate(-50%, -100%);height:var(--deckgo-drr-rotate-anchor-width, 24px);width:var(--deckgo-drr-rotate-anchor-height, 32px)}div.rotate div.action{position:absolute;top:0;left:50%;transform:translate(-50%, 0);cursor:crosshair;width:var(--deckgo-drr-rotate-anchor-action-width, 16px);height:var(--deckgo-drr-rotate-anchor-action-height, 16px);border-radius:var(--deckgo-drr-rotate-anchor-action-border-radius, 50%);background:var(--deckgo-drr-rotate-anchor-action-background);border:var(--deckgo-drr-rotate-anchor-action-border, 1px solid #3880ff)}div.rotate div.presentation{position:absolute;bottom:0;left:50%;transform:translate(-50%, 0);height:var(--deckgo-drr-rotate-anchor-presentation-height, calc(100% - 16px - 1px));border-right:var(--deckgo-drr-rotate-anchor-presentation-border-right, 1px solid #3880ff)}@media (hover: none) and (pointer: coarse){div.anchor{padding:var(--deckgo-drr-anchor-padding-mobile)}div.border.top,div.border.bottom{height:4px}div.border.end,div.border.start{width:4px}}";export{r as deckgo_drr}